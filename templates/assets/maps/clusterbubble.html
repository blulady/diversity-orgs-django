var clusterBubbleLayer = new atlas.layer.BubbleLayer(datasource, null, {
    //Scale the size of the clustered bubble based on the number of points inthe cluster.
    radius: [
      'step',
      ['get', 'point_count'],
      10,         //Default of 20 pixel radius.
      10, 30,    //If point_count >= 100, radius is 30 pixels.
      30, 40     //If point_count >= 750, radius is 40 pixels.
    ],

    //Change the color of the cluster based on the value on the point_cluster property of the cluster.
    color: [
      'step',
      ['get', 'point_count'],
      'lime',            //Default to lime green. 
      10, 'yellow',     //If the point_count >= 100, color is yellow.
      20, 'orange'        //If the point_count >= 100, color is red.
    ],
    strokeWidth: 0,
    filter: ['has', 'point_count'] //Only rendered data points which have a point_count property, which clusters do.
  });


//Add the clusterBubbleLayer and two additional layers to the map.
map.layers.add([
    clusterBubbleLayer,

//Create a symbol layer to render the count of locations in a cluster.
    new atlas.layer.SymbolLayer(datasource, null, {
    iconOptions: {
    image: 'none' //Hide the icon image.
    },
    textOptions: {
    textField: ['get', 'point_count_abbreviated'],
    offset: [0, 0.4]
    }
    }),

//Create a layer to render the individual locations.
    new atlas.layer.SymbolLayer(datasource, null, {
        filter: ['!', ['has', 'point_count']] //Filter out clustered points from this layer.
    })
]);