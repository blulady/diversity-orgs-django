     <!-- Add references to the Azure Maps Map control JavaScript and CSS files. -->
     <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css" type="text/css" />
     <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>

     <!-- Add a reference to the Azure Maps Services Module JavaScript file. -->
     <script src="https://atlas.microsoft.com/sdk/javascript/service/2/atlas-service.min.js"></script>

     <script>
     function GetMap(){
        var map = new atlas.Map("map", {
            renderWorldCopies: true,
            view: 'Auto',
            style: 'road',
            showLogo: true,
            showFeedbackLink: true,
            zoom: 1,
           // Add your Azure Maps primary subscription key. https://aka.ms/am-primaryKey
           authOptions: {
               authType: 'subscriptionKey',
               subscriptionKey: '{{AZURE_MAPS_KEY}}'
           }
       });
       
       //Wait until the map resources are ready.
       map.events.add('ready', function () {
        var datasource = new atlas.source.DataSource(null, {
            cluster: true,
            clusterRadius: 45,
            clusterMaxZoom: 15
        }
        );
        map.sources.add(datasource);
        {% for sprite in map_sprites %}
          map.imageSprite.add('{{sprite.0 | escapejs}}', '{{sprite.1 | escapejs}}').then(function(){})
        {% endfor %}
        var resultLayer = new atlas.layer.SymbolLayer(datasource, null, {
            iconOptions: {
                image: ['get', 'logo'],
                anchor: 'center',
                allowOverlap: true
            },
            textOptions: {
                anchor: "top"
            }
        });
        
        map.layers.add(resultLayer);
        map.controls.add(new atlas.control.ZoomControl(), {
            position: 'bottom-right'
        });

      datasource.importDataFromUrl("/api/map?format=json&{{map | escapejs}}")
  });
}
</script>
